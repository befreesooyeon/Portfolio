// header highlight + Ïä§ÌÅ¨Î°§ Ïó∞Îèô + ÏÜçÎèÑ Î∞òÏùëÌòï Ïï†ÎãàÎ©îÏù¥ÏÖò
document.addEventListener("DOMContentLoaded", () => {
  const gnb = document.querySelector('.gnb-c');
  const highlight = gnb.querySelector('.highlight');
  const gnbLinks = gnb.querySelectorAll('a');
  const padX = 8; // Í∞ÄÏÉÅ padding-left/right
  let activeLink = null; // ÌòÑÏû¨ active ÏÉÅÌÉúÏùò ÎßÅÌÅ¨ Ï†ÄÏû•
  let lastScrollY = window.scrollY; // ÎßàÏßÄÎßâ Ïä§ÌÅ¨Î°§ ÏúÑÏπò Ï†ÄÏû•

  // üìå Í≥µÌÜµ Ïä§ÌÅ¨Î°§ Ïï†ÎãàÎ©îÏù¥ÏÖò Ìï®Ïàò
  function smoothScrollTo(targetY, duration = 1, ease = "power2.inOut") {
    gsap.to(window, {
      scrollTo: targetY,
      duration: duration,
      ease: ease
    });
  }

  // üìå ÏïµÏª§ ÎßÅÌÅ¨ Ïä§ÌÅ¨Î°§ Ï≤òÎ¶¨ Ìï®Ïàò
  function handleAnchorClick(e, link) {
    e.preventDefault();
    const targetId = link.getAttribute('href');
    if (targetId && targetId.startsWith('#')) {
      let targetY;
      const headerOffset = 130; // Ìó§Îçî ÎÜíÏù¥
      
      // #home ÌÅ¥Î¶≠ Ïãú ÌéòÏù¥ÏßÄ Îß® ÏúÑÎ°ú Ïù¥Îèô
      if (targetId === '#home') {
        targetY = 0;
      } 
      // #footer ÌÅ¥Î¶≠ Ïãú Ïä§ÌÅ¨Î°§ Í∞ÄÎä•Ìïú Îß® ÏïÑÎûòÎ°ú Ïù¥Îèô (margin-bottom Ìè¨Ìï®)
      else if (targetId === '#footer') {
        targetY = document.documentElement.scrollHeight - window.innerHeight;
      } 
      else {
        const target = document.querySelector(targetId);
        if (target) {
          targetY = target.getBoundingClientRect().top + window.scrollY - headerOffset;
        } else {
          return;
        }
      }
      
      smoothScrollTo(targetY);
    }
  }

  // highlight Ïù¥Îèô + ÌÅ¨Í∏∞ ÏÑ§Ï†ï Ìï®Ïàò
  function moveHighlightTo(link, speedFactor = 1) {
    if (!link || !highlight) return;
    
    const gnbRect = gnb.getBoundingClientRect();
    const linkRect = link.getBoundingClientRect();
    const linkLeft = linkRect.left - gnbRect.left;
    const linkWidth = linkRect.width;

    gsap.to(highlight, {
      left: linkLeft - padX,
      width: linkWidth + padX * 2,
      duration: 0.3 / speedFactor,
      ease: speedFactor > 1 ? "elastic.out(1, 0.5)" : "power2.out"
    });
  }

  // active ÏÉÅÌÉú Ï†ÅÏö©
  function setActiveLink(link, speedFactor = 1) {
    if (!link) return;
    
    gnbLinks.forEach(a => a.classList.remove('active'));
    link.classList.add('active');
    activeLink = link;

    applyLinkColors();
    moveHighlightTo(link, speedFactor);
  }

  // üìå ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í∏∞Î≥∏ ÌôúÏÑ±Ìôî (Ï≤´ Î≤àÏß∏ ÎßÅÌÅ¨)
  if (gnbLinks.length > 0) {
    activeLink = gnbLinks[0];
    setTimeout(() => {
      setActiveLink(activeLink);
    }, 100);
  }

  
  // üìå ÎßàÏö∞Ïä§ Ïò¨Î¶¨Î©¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïù¥Îèô
  gnbLinks.forEach(link => {
    link.addEventListener('mouseenter', () => moveHighlightTo(link));
  });

  // üìå Î©îÎâ¥ Ï†ÑÏ≤¥ÏóêÏÑú ÎßàÏö∞Ïä§ ÎÇòÍ∞ÄÎ©¥ active ÏúÑÏπòÎ°ú Î≥µÍ∑Ä
  gnb.addEventListener('mouseleave', () => {
    if (activeLink) moveHighlightTo(activeLink);
  });

  // üìå ÌÅ¥Î¶≠ Ïãú active Í≥†Ï†ï + Ïä§ÌÅ¨Î°§ Ïù¥Îèô
  gnbLinks.forEach(link => {
    link.addEventListener('click', e => {
      setActiveLink(link);
      handleAnchorClick(e, link);
    });
  });

  // üìå Ïä§ÌÅ¨Î°§ Ïãú ÌòÑÏû¨ ÏÑπÏÖòÏóê ÎßûÏ∂∞ active Î≥ÄÍ≤Ω + ÏÜçÎèÑ Î∞òÏùëÌòï Ïï†ÎãàÎ©îÏù¥ÏÖò
  const sections = [
    { 
      link: Array.from(gnbLinks).find(link => link.getAttribute('href') === '#home'),
      section: document.querySelector('#home')
    },
    { 
      link: Array.from(gnbLinks).find(link => link.getAttribute('href') === '#about'),
      section: document.querySelector('#about')
    },
    { 
      link: Array.from(gnbLinks).find(link => link.getAttribute('href') === '#works'),
      section: document.querySelector('#works')
    }
  ].filter(item => item.link && item.section);

  let scrollTimeout;
  window.addEventListener('scroll', () => {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      const scrollY = window.scrollY;
      const headerOffset = 140;

      // üìå Ïä§ÌÅ¨Î°§ ÏÜçÎèÑ Í≥ÑÏÇ∞
      const scrollSpeed = Math.abs(scrollY - lastScrollY);
      lastScrollY = scrollY;
      const speedFactor = Math.min(Math.max(scrollSpeed / 50, 1), 3); 

      let current = null;
      
      // ÌéòÏù¥ÏßÄ Îß® ÏïÑÎûòÏóêÏÑú CONTACT ÌôúÏÑ±Ìôî
      if (scrollY + window.innerHeight >= document.documentElement.scrollHeight - 100) {
        current = Array.from(gnbLinks).find(link => link.getAttribute('href') === '#footer');
      } else {
        // Í∞Å ÏÑπÏÖòÏùò ÏãúÏûëÏ†ê Í∏∞Ï§ÄÏúºÎ°ú ÌôúÏÑ±Ìôî
        for (const { link, section } of sections.reverse()) {
          const sectionTop = section.offsetTop - headerOffset;
          
          if (scrollY >= sectionTop) {
            current = link;
            break;
          }
        }
        sections.reverse();
      }

      if (current && current !== activeLink) {
        setActiveLink(current, speedFactor);
      }
    }, 10);
  });

  // üìå Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú active ÏúÑÏπò Ïû¨Ï°∞Ï†ï
  window.addEventListener('resize', () => {
    setTimeout(() => {
      if (activeLink) moveHighlightTo(activeLink);
    }, 100);
  });

  // üìå Ï†ÑÏ≤¥ ÌéòÏù¥ÏßÄ ÎÇ¥ a[href^="#"] ÌÅ¥Î¶≠ Ïãú Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§ Ï†ÅÏö© (gnb Ï†úÏô∏)
  const allLinks = document.querySelectorAll('a[href^="#"]:not(.gnb-c a)');
  allLinks.forEach(link => {
    link.addEventListener('click', function (e) {
      handleAnchorClick(e, this);
    });
  });

    // Îã§ÌÅ¨/ÎùºÏù¥Ìä∏ Î™®ÎìúÏóê ÎßûÏ∂∞ ÎßÅÌÅ¨ ÏÉâÏÉÅ Ï†ÅÏö©
  function applyLinkColors() {
    const isDark = document.body.classList.contains('dark-mode');
    gnbLinks.forEach(a => a.style.color = isDark ? "#dbdbdb" : "#252525");
    if (activeLink) {
      activeLink.style.color = isDark ? "#252525" : "#ffffff";
    }
  }

  // üìå Dark Mode Ïï†ÎãàÎ©îÏù¥ÏÖò ÏÑ§Ï†ï Í∞ùÏ≤¥
const themeAnimationConfig = {
  dark: {
    buttonText: 'DARK',
    animations: [
      ["body", { backgroundColor: "#f5f5f5", color: "#dbdbdb" }],
      [".wrap", { backgroundColor: "#000", color: "#dbdbdb" }],

      ["#themeToggle span", { backgroundColor: "#dbdbdb", scale: 1.3, yoyo: true, repeat: 1, duration: 0.2 }],

      [".section-light", { backgroundColor: "#f5f5f5" }],
      [".section-dark", { backgroundColor: "#000000", color: "#dbdbdb" }],
      [".text-dark", { color: "#dbdbdb" }],
      [".modal-content", { backgroundColor: "#000000" }],

      // SVG
      ["svg path", { fill: "#dbdbdb", stroke: "#dbdbdb" }],
      ["header .innerHeader .gnb-r ul li a svg path, .about .inner .profile .left a svg path", { fill: "#dbdbdb", stroke: "#dbdbdb" }],
      [".tooltip-tail path", { fill: "#4A6CF7", stroke: "none" }],
      [".orizin .inner .orizin-marquee .o-marquee .marquee-track .content1 .icon1 path, .works .title svg path, .footer .inner .footer-bottom .footer-spin path", { fill: "#B7D3C6", stroke: "#B7D3C6" }],
      [".orizin .inner .orizin-marquee .o-marquee .marquee-track .content2 .icon path", { fill: "none", stroke: "#dbdbdb" }],
      [".about .inner .contents .box .grid .title .skill-icon svg path", { fill: "none", stroke: "#dbdbdb" }],
      [".about .inner .contents .box .accordion-list .accordion-item .accordion-icon path, .works .inner .portfolio-grid .card .thumbnail .icon-circle svg path", { fill: "#dbdbdb", stroke: "none" }],
      
      // Borders
      ["header .innerHeader .gnb-c", { borderColor: "#dbdbdb" }],
      ["header .innerHeader .gnb-r ul li", { borderColor: "#dbdbdb" }],
      [".orizin .inner .orizin-marquee .o-marquee", { borderColor: "#dbdbdb" }],
      [".become .inner .left .tit .point", { borderColor: "#dbdbdb" }],
      [".become .inner .right img", { borderColor: "#dbdbdb" }],
      [".keyWords .textWrap .line3", { borderColor: "#dbdbdb" }],
      [".marquee", { borderColor: "#dbdbdb" }],
      [".about .inner .profile .left .info span, .about .inner .profile .left a ", { borderColor: "#dbdbdb" }],
      [".about .inner .contents .box ", { borderColor: "#dbdbdb" }],
      [".about .inner .contents .box .list li, .about .inner .contents .box .accordion-list .accordion-item  ", { borderColor: "#dbdbdb" }],
      [".works .inner .filter-wrapper .filter-navigation, #loadMoreBtn", { borderColor: "#dbdbdb" }],
      [".my-photo .inner .text-wrap a", { borderColor: "#dbdbdb", backgroundColor: "#000000" }],
      [".footer .inner .footer-meta", { borderColor: "#252525"}],


      // Highlights / Buttons
      ["header .innerHeader .gnb-c .highlight", { backgroundColor: "#d4d4d4" }],
      ["header .innerHeader .gnb-r ul li a span", { backgroundColor: "#dbdbdb" }],
      [".narrative .scroll-btn", { backgroundColor: "#000000", borderColor: "#dbdbdb" }],
      [".narrative .scroll-btn svg path", { fill: "none", stroke: "#dbdbdb" }],
      [".orizin .inner .orizin-marquee .o-marquee svg", { fill: "none", stroke: "#dbdbdb" }],
      [".keyWords .textWrap .line-divider", { backgroundColor: "#dbdbdb" }],
      ["header .innerHeader .gnb-r ul li a .icon-wrap path, .about .inner .profile .left a svg path", { fill: "#dbdbdb", stroke: "none" }],
      [".works .inner .portfolio-grid .card .thumbnail .icon-circle", {backgroundColor: "#000000"}],
      ["#photoModal .modal-nav-btn svg path", {stroke: "#dbdbdb"}],

      // Text
      [".visual .subText .copyright, .now .inner .left .folder .folder-content .textBox", { color: "#999999" }],
      [".works .inner .portfolio-grid .card .card-content .tit p, .works .inner .portfolio-grid .card .card-content .description", { color: "#999999" }],
      [".gallery-card .card-info", { color: "#f5f5f5"}],
      [".gallery-card .card-info p", { color: "#dbdbdb"}],
      [".footer", { color: "#252525", backgroundColor: "#dbdbdb"}],
      ["#projectModal .modal-content .content .project-visual .inner .bottom .project-text", {color: "#999999"}],


      
      // fortune
      ["#fortuneModal .modal-content, #fortuneModal .modal-content .content .select-btn", {backgroundColor: "#000000", color: "#dbdbdb", borderColor: "#dbdbdb"}],
    ]
  },

  light: {
    buttonText: 'LIGHT',
    animations: [
      ["body", { backgroundColor: "#000000", color: "#252525" }],
      [".wrap", { backgroundColor: "#f5f5f5", color: "#252525" }],

      ["#themeToggle span", { backgroundColor: "#000", scale: 1.3, yoyo: true, repeat: 1, duration: 0.2 }],

      [".section-light", { backgroundColor: "#f5f5f5" }],
      [".section-dark", { backgroundColor: "#000000", color: "#dbdbdb" }],
      [".text-dark", { color: "#252525" }],
      [".modal-content", { backgroundColor: "#f5f5f5" }],

      // SVG
      ["svg path", { fill: "#252525", stroke: "#252525" }],
      ["header .innerHeader .gnb-r ul li a svg path, .about .inner .profile .left a svg path", { fill: "#252525", stroke: "#252525" }],
      [".tooltip-tail path", { fill: "#4A6CF7", stroke: "none" }],
      [".orizin .inner .orizin-marquee .o-marquee .marquee-track .content1 .icon1 path, .works .title svg path, .footer .inner .footer-bottom .footer-spin path", { fill: "#B7D3C6", stroke: "#B7D3C6" }],
      [".orizin .inner .orizin-marquee .o-marquee .marquee-track .content2 .icon path", { fill: "none", stroke: "#252525" }],
      [".about .inner .contents .box .grid .title .skill-icon svg path", { fill: "none", stroke: "#252525" }],
      [".about .inner .contents .box .accordion-list .accordion-item .accordion-icon path, .works .inner .portfolio-grid .card .thumbnail .icon-circle svg path", { fill: "#252525", stroke: "none" }],
      

      // Borders
      ["header .innerHeader .gnb-c", { borderColor: "#252525" }],
      ["header .innerHeader .gnb-r ul li", { borderColor: "#252525" }],
      [".orizin .inner .orizin-marquee .o-marquee", { borderColor: "#252525" }],
      [".become .inner .left .tit .point", { borderColor: "#252525" }],
      [".become .inner .right img", { borderColor: "#252525" }],
      [".keyWords .textWrap .line3", { borderColor: "#252525" }],
      [".marquee", { borderColor: "#252525" }],
      [".about .inner .profile .left .info span, .about .inner .profile .left a ", { borderColor: "#252525" }],
      [".about .inner .contents .box ", { borderColor: "#252525" }],
      [".about .inner .contents .box .list li, .about .inner .contents .box .accordion-list .accordion-item  ", { borderColor: "#252525" }],
      [".works .inner .filter-wrapper .filter-navigation, #loadMoreBtn", { borderColor: "#252525" }],
      [".my-photo .inner .text-wrap a", { borderColor: "#252525", backgroundColor: "#f5f5f5" }],
      [".footer .inner .footer-meta", { borderColor: "#dbdbdb"}],    

      // Highlights / Buttons
      ["header .innerHeader .gnb-c .highlight", { backgroundColor: "#d4d4d4" }],
      ["header .innerHeader .gnb-r ul li a span", { backgroundColor: "#000000" }],
      [".narrative .scroll-btn", { backgroundColor: "#f5f5f5", borderColor: "#252525" }],
      [".narrative .scroll-btn svg path", { fill: "none", stroke: "#252525" }],
      [".orizin .inner .orizin-marquee .o-marquee svg", { fill: "none", stroke: "#252525" }],
      [".keyWords .textWrap .line-divider", { backgroundColor: "#252525" }],
      ["header .innerHeader .gnb-r ul li a .icon-wrap path, .about .inner .profile .left a svg path", { fill: "#252525", stroke: "none" }],
      [".works .inner .portfolio-grid .card .thumbnail .icon-circle", {backgroundColor: "#ffffff"}],
      ["#photoModal .modal-nav-btn svg path", {stroke: "#252525"}],
      

      // Text
      [".visual .subText .copyright", { color: "#777777" }],
      [".now .inner .left .folder .folder-content .textBox", { color: "#666666" }],
      [".works .inner .portfolio-grid .card .card-content .tit p, .works .inner .portfolio-grid .card .card-content .description", { color: "#666666" }],
      [".gallery-card .card-info", { color: "#333333"}],
      [".gallery-card .card-info p", { color: "#666666"}],
      [".footer", { color: "#dbdbdb", backgroundColor: "#000000"}],
      ["#projectModal .modal-content .content .project-visual .inner .bottom .project-text", {color: "#666666"}],

      // fortune
      ["#fortuneModal .modal-content, #fortuneModal .modal-content .content .select-btn", {backgroundColor: "#f5f5f5", color: "#252525", borderColor: "#252525"}],
    ]
  }
};

// Dark Mode ÌÜ†Í∏Ä + Hover Ìö®Í≥º
const themeToggle = document.getElementById('themeToggle');
if (themeToggle) {
  const span = themeToggle.querySelector('span');

  // ÌÅ¥Î¶≠ Ïãú Îã§ÌÅ¨/ÎùºÏù¥Ìä∏ Î™®Îìú Ï†ÑÌôò
  themeToggle.addEventListener('click', function (e) {
    e.preventDefault();

    const body = document.body;
    const isDark = body.classList.toggle('dark-mode');
    const config = isDark ? themeAnimationConfig.dark : themeAnimationConfig.light;

    const tl = gsap.timeline({ defaults: { duration: 0.5, ease: "power2.inOut" } });
    this.firstChild.textContent = config.buttonText;

    config.animations.forEach(([selector, props]) => {
      tl.to(selector, props, 0);
    });

    applyLinkColors();
  });

  // ‚≠ê Hover ‚Üí pulse Ìö®Í≥º
  themeToggle.addEventListener('mouseenter', () => {
    gsap.to(span, {
      scale: 1.2,
      duration: 0.3,
      ease: "power2.out",
      yoyo: true,
      repeat: 1 // scale ‚Üí ÏõêÎûò ÌÅ¨Í∏∞ ‚Üí Îã§Ïãú scale
    });
  });

  themeToggle.addEventListener('mouseleave', () => {
    gsap.to(span, {
      scale: 1,
      duration: 0.2,
      ease: "power2.inOut"
    });
  });
}


});

// Í∞ÄÎ°úÏä§ÌÅ¨Î°§ start
// Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ + Î≤ÑÌäº Ïù¥Îèô
window.addEventListener("DOMContentLoaded", () => {
  gsap.registerPlugin(ScrollTrigger, ScrollToPlugin); // ScrollToPlugin ÏóÜÏúºÎ©¥ Îì±Î°ùÎßå ÎêòÍ≥† Î¨¥ÏãúÎê®

  const sections = gsap.utils.toArray(".narrative-container section");
  const getScrollLen = () => sections.reduce((s, el) => s + el.offsetWidth, 0) - window.innerWidth;

  let scrollLen = getScrollLen();

  gsap.to(sections, {
    x: -scrollLen,
    ease: "none",
    scrollTrigger: {
      id: "narrativeScroll",            // ‚Üê Ïù¥ idÎ°ú Ï∞æÏùå
      trigger: ".narrative-container",
      pin: true,
      scrub: 1,
      start: "top top",
      end: () => "+=" + scrollLen
    }
  });

  // Ïä§ÌÅ¨Î°§ Î≤ÑÌäº ‚Üí #next-sectionÏúºÎ°ú
  document.querySelector(".scroll-btn")?.addEventListener("click", (e) => {
    e.preventDefault();
    const target = document.querySelector("#next-section");
    const st = ScrollTrigger.getById("narrativeScroll");
    if (!target || !st) return;

    // Í∞ÄÎ°ú offsetLeft ‚Üí ÏÑ∏Î°ú Ïä§ÌÅ¨Î°§ ÏúÑÏπòÎ°ú Î≥ÄÌôò
    const y = Math.min(st.start + target.offsetLeft, st.end);

    if (gsap.plugins && gsap.plugins.scrollTo) {
      gsap.to(window, { scrollTo: y, duration: 1, ease: "power2.inOut" });
    } else {
      window.scrollTo({ top: y, behavior: "smooth" }); // ÌîåÎü¨Í∑∏Ïù∏ ÏóÜÏùÑ ÎïåÎèÑ ÎèôÏûë
    }
  });

  // Î¶¨ÏÇ¨Ïù¥Ï¶à Î∞òÏòÅ
  window.addEventListener("resize", () => {
    scrollLen = getScrollLen();
    ScrollTrigger.refresh();
  });


  // Î°úÍ≥† ÌöåÏ†Ñ
  [
    { selector: ".line1 .logo-spin", trigger: ".visual", start: "top top", end: "bottom top" },
    { selector: ".footer-spin", trigger: "body", start: "top bottom", end: "bottom top" }
  ].forEach(cfg => {
    gsap.to(cfg.selector, {
      rotation: 360,
      ease: "none",
      scrollTrigger: { trigger: cfg.trigger, start: cfg.start, end: cfg.end, scrub: 0.1 }
    });
  });

  // ÌëúÏßÄ hover Ïãú Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω
  const tabs = document.querySelectorAll(".tab");
  const mainImage = document.getElementById("mainImage");
  const mainTxt = document.getElementById("mainTxt");
  const defaultImage = "images/narrativePhoto.png";
  const defaultText = "Í∞Å ÌÇ§ÏõåÎìúÏóê Ìò∏Î≤ÑÌï¥Î≥¥ÏÑ∏Ïöî ‚ò∫";

tabs.forEach(tab => {
  tab.addEventListener("mouseenter", () => {
    // Ïù¥ÎØ∏ÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò
    mainImage.classList.add("reveal");
    mainTxt.classList.add("text-out");

    setTimeout(() => {
      // ÏÉàÎ°úÏö¥ Ïù¥ÎØ∏ÏßÄ & ÌÖçÏä§Ìä∏ Ï†ÅÏö©
      mainImage.src = `images/${tab.dataset.image}`;
      mainTxt.textContent = tab.dataset.text;

      // Ïï†ÎãàÎ©îÏù¥ÏÖò Î¶¨ÏÖã + Î∞òÎåÄÎ∞©Ìñ•ÏúºÎ°ú ÎÇòÌÉÄÎÇ®
      mainImage.classList.remove("reveal");
      mainTxt.classList.remove("text-out");
      mainTxt.classList.add("text-in");

      // text-in Ìö®Í≥º ÎÅùÎÇòÎ©¥ Ï†úÍ±∞ (Îã§Ïùå Ïï†ÎãàÎ•º ÏúÑÌï¥)
      setTimeout(() => mainTxt.classList.remove("text-in"), 600);
    }, 400);
  });

  tab.addEventListener("mouseleave", () => {
    // ÏõêÎûò Ïù¥ÎØ∏ÏßÄ/ÌÖçÏä§Ìä∏Î°ú Î≥µÍ∑Ä
    mainImage.classList.add("reveal");
    mainTxt.classList.add("text-out");

    setTimeout(() => {
      mainImage.src = defaultImage;
      mainTxt.textContent = defaultText;

      mainImage.classList.remove("reveal");
      mainTxt.classList.remove("text-out");
      mainTxt.classList.add("text-in");

      setTimeout(() => mainTxt.classList.remove("text-in"), 600);
    }, 400);
  });
});



  // Tooltip Ïù¥Îèô
  const tooltip = document.querySelector(".tooltip");
  const nowSection = document.querySelector(".narrative-container .now");
  if (tooltip && nowSection) {
    gsap.to(tooltip, {
      top: "50%",
      left: "18%",
      ease: "none",
      scrollTrigger: {
        trigger: ".now",
        start: "top",
        end: () => "+=" + (nowSection.offsetLeft + nowSection.offsetWidth) + "px",
        scrub: 1
      }
    });
  }

  // keywords Î∞òÎ≥µ ÌÖçÏä§Ìä∏
  const scrollText = document.querySelector(".keyWords .scrollText");
  if (scrollText) {
    scrollText.innerHTML = scrollText.innerHTML.repeat(3);
    gsap.to(scrollText, {
      x: "-50%",
      ease: "none",
      scrollTrigger: {
        trigger: ".keyWords",
        start: "top bottom",
        end: "bottom top",
        scrub: 1
      }
    });
  }

  // About ÏïÑÏΩîÎîîÏñ∏
  const accordionItems = document.querySelectorAll(".accordion-item");
  accordionItems.forEach(item => {
    const tit = item.querySelector(".accordion-tit");
    const content = item.querySelector(".accordion-content");
    tit?.addEventListener("click", () => {
      const active = item.classList.contains("active");
      accordionItems.forEach(i => {
        i.classList.remove("active");
        i.querySelector(".accordion-content").style.maxHeight = 0;
      });
      if (!active) {
        item.classList.add("active");
        content.style.maxHeight = content.scrollHeight + "px";
      }
    });
  });

  // Works filter indicator
  const filterItems = document.querySelectorAll(".filter-item");
  const indicator = document.querySelector(".filter-indicator");
  filterItems.forEach(item => {
    item.addEventListener("click", () => {
      filterItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      gsap.to(indicator, { x: item.offsetLeft, duration: 0.5, ease: "power2.out" });
    });
  });

  // Works Ïπ¥Îìú hover ‚Üí icon-circle Ïï†ÎãàÎ©îÏù¥ÏÖò
  const portfolioGrid = document.querySelector(".works .inner .portfolio-grid");
  portfolioGrid?.addEventListener("mouseenter", e => {
    const card = e.target.closest(".card");
    if (!card) return;
    const icon = card.querySelector(".icon-circle svg");
    if (!icon) return;
    gsap.to(icon, {
      xPercent: 100,
      duration: 0.25,
      ease: "power2.in",
      onComplete: () => {
        gsap.set(icon, { xPercent: -100 });
        gsap.to(icon, { xPercent: 0, duration: 0.25, ease: "power2.out" });
      }
    });
  }, true);
});



